<div [formGroup]="form" class="isolate-row" [class.failed]="form.get('failure') != null" *ngIf="form">

   <div class="isolate-num" matTooltip="isolate number" *ngIf="showIsolateNumber">{{isolateNumber}}</div>

   <!-- SLANT stage editing -->
   <app-isolate-slant-stage-editor *ngIf="stage === 'SLANT' && allowDataChanges"
      [form]="form"
      [allowDataChanges]="allowDataChanges"
      [testUnitDescription]="testUnitDescription"
      [medium]="medium"
      [selectiveAgarDisplayName]="selectiveAgarDisplayName"
      [includeOxidase]="includeOxidase"
      [showUnsetAffordances]="showUnsetAffordances">
   </app-isolate-slant-stage-editor>

   <!-- read-only SLANT data view as context in IDENT stage -->
   <app-isolate-slant-stage-view *ngIf="stage === 'IDENT' && viewContextData || stage === 'SLANT' && !allowDataChanges"
     [form]="form"
     [includeOxidase]="includeOxidase">
   </app-isolate-slant-stage-view>

   <!-- IDENT stage editing -->
   <div class="ident-editing-area" *ngIf="stage === 'IDENT' && allowDataChanges">
      <app-isolate-identification-editor *ngIf="form.get('identification') != null"
         [form]="form.get('identification')"
         [allowDataChanges]="allowDataChanges">
      </app-isolate-identification-editor>
   </div>

   <!-- IDENT data read-only view as context -->
   <app-isolate-identification-view
      *ngIf="form.get('identification') != null &&
         ( stage === 'SLANT' && viewContextData || stage == 'IDENT' && !allowDataChanges )"
      [form]="form">
   </app-isolate-identification-view>

   <div class="expanding-flex-space"></div>

   <div class="ident-required-indicator"
        *ngIf="stage === 'SLANT' && !viewContextData && form.get('identification') != null">
      <mat-icon>arrow_forward</mat-icon>
   </div>

   <div class="isolate-actions" *ngIf="allowDataChanges">
      <mat-menu #actionsMenu="matMenu">
         <span class="menu-header">Actions for {{isolateDescription}}</span>
         <hr>
         <div class="menu-item">
            <button mat-button class="remove" *ngIf="showDisposeButton" (click)="onDisposeRequested()" type="button">
                <mat-icon>delete_forever</mat-icon>
                delete isolate
            </button>
         </div>
         <div class="menu-item">
            <button mat-button class="fail" *ngIf="!this.form.controls.failure" type="button"
               (click)="promptEditFailureInfo()">
               <mat-icon>thumb_down</mat-icon> mark isolate as failed
            </button>
         </div>
         <div class="menu-item">
            <button mat-button class="unfail" *ngIf="!!this.form.controls.failure" type="button"
                    (click)="clearFailure()">
               <mat-icon>thumb_up</mat-icon>
               mark isolate as not failed
            </button>
         </div>
         <div class="menu-item">
            <button mat-button *ngIf="!!this.form.controls.failure" (click)="promptEditFailureInfo()" type="button">
               <mat-icon>edit</mat-icon><mat-icon>thumb_down</mat-icon>
               edit failure information
            </button>
         </div>
         <div class="menu-item" *ngIf="stage === 'SLANT' && form.get('identification') == null">
            <button mat-button *ngIf="form.get('identification') == null" type="button"
               (click)="createIdentificationFormGroup()">
               mark isolate for identification via API20E/Vitek
            </button>
         </div>
         <div class="menu-item" *ngIf="stage === 'SLANT' && form.get('identification') != null">
            <button mat-button (click)="removeIdentificationFormGroup()" type="button">
               unmark isolate for identification (removes API20E/Vitek data)
            </button>
         </div>
      </mat-menu>

      <button class="hover-link row-actions" [matMenuTriggerFor]="actionsMenu" type="button">
         <mat-icon>more_vert</mat-icon>
      </button>
   </div> <!-- isolate actions -->

</div>
