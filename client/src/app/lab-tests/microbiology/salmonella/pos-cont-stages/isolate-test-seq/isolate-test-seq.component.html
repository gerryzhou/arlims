<form [formGroup]="form" class="isolate-row" [class.failed]="form.get('failure') != null" *ngIf="form">

   <div class="isolate-num" matTooltip="isolate number" *ngIf="showIsolateNumber">{{isolateNumber}}</div>

   <!-- SLANT stage editing -->
   <app-isolate-slant-stage-editor *ngIf="stage === 'SLANT' && !viewOnly"
      [form]="form"
      [testUnitDescription]="testUnitDescription"
      [medium]="medium"
      [selectiveAgarDisplayName]="selectiveAgarDisplayName"
      [includeOxidase]="includeOxidase">
   </app-isolate-slant-stage-editor>

   <!-- read-only SLANT data view as context in IDENT stage -->
   <app-isolate-slant-stage-view *ngIf="stage === 'IDENT' && viewContextData || stage === 'SLANT' && viewOnly"
     [form]="form"
     [includeOxidase]="includeOxidase">
   </app-isolate-slant-stage-view>

   <!-- IDENT stage editing -->
   <div class="ident-editing-area" *ngIf="stage === 'IDENT' && !viewOnly">
      <button class="link" *ngIf="!viewOnly && form.get('identification') == null"
              (click)="createIdentificationFormGroup()">
         enter API20E/Vitek data
      </button>
      <app-isolate-identification-editor *ngIf="form.get('identification') != null"
         [form]="form.get('identification')"
         [viewOnly]="viewOnly">
      </app-isolate-identification-editor>
   </div>

   <!-- IDENT data read-only view as context -->
   <app-isolate-identification-view
      *ngIf="form.get('identification') != null &&
         ( stage === 'SLANT' && viewContextData || stage == 'IDENT' && viewOnly )"
      [form]="form">
   </app-isolate-identification-view>

   <div class="expanding-flex-space"></div>

   <div class="isolate-actions" *ngIf="!viewOnly">
      <mat-menu #actionsMenu="matMenu">
         <span class="menu-header">Actions for {{isolateDescription}}</span>
         <hr>
         <div class="menu-item">
            <button mat-button class="remove" *ngIf="showDisposeButton" (click)="onDisposeRequested()">
                <mat-icon>delete_forever</mat-icon> delete isolate
            </button>
         </div>
         <div class="menu-item">
            <button mat-button class="fail" *ngIf="!this.form.controls.failure" (click)="promptEditFailureInfo()">
               <mat-icon>thumb_down</mat-icon> mark isolate as failed
            </button>
         </div>
         <div class="menu-item">
            <button mat-button class="unfail" *ngIf="!!this.form.controls.failure" (click)="clearFailure()">
                <mat-icon>thumb_up</mat-icon> mark isolate as not failed
            </button>
         </div>
         <div class="menu-item">
            <button mat-button *ngIf="!!this.form.controls.failure" (click)="promptEditFailureInfo()">
               <mat-icon>edit</mat-icon><mat-icon>thumb_down</mat-icon> edit failure information
            </button>
         </div>
         <div class="menu-item" *ngIf="stage === 'IDENT' && form.get('identification') != null">
            <button mat-button *ngIf="!viewOnly" (click)="removeIdentificationFormGroup()">
               remove API20E/Vitek data
            </button>
         </div>
      </mat-menu>

      <button class="hover-link" [matMenuTriggerFor]="actionsMenu">
         <mat-icon>more_vert</mat-icon>
      </button>
   </div>

</form>
