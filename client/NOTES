Done
====
- Tweak layout in new test dialog and default to current date.
- Make date pickers easier to use for touchscreen devices.
  Clicking anywhere on text field opens date picker dialog, and dialog now centered and larger.
- For prep stage received fields auto-fill feature, combine "transfers to me" and "transfers to anyone" buttons.
  In resulting dialog, transfers to the current user are displayed above transfers to others.
  Remove FACTS person id from received-from text.
- For water bath start timestamp in M-broth stage, separate format to right with subdued font.
- In samples listing:
  - Show visible statuses inline as row of toggle buttons, add 'T' status choice.
  - Sync selected statuses to and from local storage via new Angular service.
- Add application version dialog with information provided by version control system as part of build process.
- Specify min sizes of some items within sample component so they are aligned when samples are vertically stacked.
- Re-enable within-tests search feature.
- In M-Broth stage set water bath start time to current timestamp when a water bath is selected.
- In prep stage when selecting from FACTS transfers, set fields without prompting when there is only one transfer.
- Rename pdf test report output file to include sample number, paf, and test type.
- Field names updated to match latest LABS DS api.
- Correct stage statuses for positive continuation stages (SLANT and IDENT) to reflect empty status when not modified through multiple save/reloads.
- In person inbox, add work assignment status display and sorting.


Apply some kind of sorting to samples listing by default.

Submit employee work hours to FACTS in wrapup via new button.


PRE-ENR
  Test units change notification is being fired for each field updated when a selection is made, should only fire once after fields are set.
  sampleTestUnitsChange event in stage pre enr component.

BAM data submission: Any pos detection of SLM among isolates should yield a single 'POS' result, else 'NEG'.


Tests Search
  - Tests search should persist through navigations.
    Add a new Angular service to hold most recent search(es).
  - Date range not properly inclusive of endpoints.
    E.g. to search for single day, should specify that day at both endpoints.

Sort person inbox, allow user to control which properties to sort by.

Improve error message: "Failed to delete test [Object object]"

Don't auto-push after Vidas stage.
  Just single-submit FACTS for now at WRAPUP stage.
    Show both AOAC and BAM submissions and any errors.
    Add button at sample level leading to page to push to FACTS (under # files).
  VIDAS:
            if ( this.ensureTestDataCompleteForAOACFactsSubmitOrWarn(testData) )
               this.submitAOACDataToFactsAsync(testData);
  WRAPUP:
            if ( this.vidasPositiveSampleTestUnitNumbers.length > 0 )
            {
               if ( this.ensureTestDataCompleteForBAMFactsSubmitOrWarn(testData) )
                  this.submitBAMDataToFactsAsync(testData);
            }
            else
            {
               this.alertMsgSvc.alertSuccess(
                  'Test data saved, no positive findings are present ' +
                  'so no FACTS submission was done.', true
               );
               this.doAfterSaveNavigation();
            }
            break;
      }


Identify isolates by their number not by creation timestamp.

Add lab inbox page based on sample listing.
  For lab admins only.
  Just route to samples listing component but add route data to specify lab inbox is wanted.
    Modify resolver and samples listing component to load/refresh from the proper source in each case.

Login dialog is misaligned vs. progress spinner.


Try to reduce the angular/webpack's package size, see notes on ipad.


SLM test
  Implement actual validation function for each stage, returning list of complaints.

FACTS WRITING PROCESS
---------------------
  Staging
    - Need to record somewhere what stages of FACTS writing have already been completed so
      stages aren't repeated or executed without prerequisites.

[Process]
Problem area = 'MICROID'
Genus = 'SLML'
Species = 'SLML998' ("Not Speciated")
Method Source = 'AOAC' ("Association of Official Analytical Chemists")
  because using Vidas
Method code = 'T2004.03' for ARL Vidas SLM tests, other labs may use other codes.
 John: Let user choose from selection obtained from:
     2.1.4.31 GET /LabsDataService/api/MicMethodCodes  (p.53 Leidos API docs)
 (sch:) But this seems it would be better as lab config item if it's constant within labs.

If spiking was done:
  Kit Cmpr Test = Y
  Enter Kit Test data:
    Sub/Comp #: Which sub/comp was used for spiking
    Rapid Method Results (Vidas) = POS/NEG
    Conventional Method Results = NA (since Vidas is always done prior to conventional methods)
    Spike Results: POS/NEG
    Genus/Species Used for Spike: S. cerro for ARL, may vary by lab
    Kit compare remarks: text describing results, for ARL something like "7 CFUs on blood agar"

If testing subs:
  specify "individual subs examined"
else (testing composites)
  specify "# subs used comp" (subs per composite), and
  "# comp exam" (number of composites)

In either case, also specify # positives detected in #Subs/Comp Detect Fnd.

If # positives is 0, then the data entry is done and hours are entered.

This completes the AOAC (Vidas) submission, the remainder is via another (BAM) submission.

If # positives is > 0:
  Add new line under the sample for "Method Applied".
  MICROID / SLML / SLML998 as before
  Method Source = BAM
  Method Code = B160 ("SALMONELLA - CONVENTIONAL") as specified in BAM.
  Kit Compressor Test = N
  Num [Subs/]Composites examined = num positives from Vidas results
  #Subs/Comp Detect Fnd = number of positive identifications made among the positive continuations

If any identifications were made (positive #Subs/Comp Detect Fnd in last step):
  Enter findings ("Micro-Id Find"):
    Sub/Comp # = 1 (relative numbering among Vidas positives?)
    Genus/Species as above
    Presence/Sterility Results = POS (always form slm)
    Need one isolate-send record for each of Serology, PFGE, and WGS (in that order, per positive sub/comp).
    num isolates sent = 1
    FDA Confirmation Lab = ARKL
    Confirmation Type = for the three records: SALMONELLA SEROTYPING (SPECIATION), PFGE - SALMONELLA, WGS - Salmonella
      (Need codes for these.)
    Then "send isolate" action is done, which results in the creation of a secondary PAF ("SAL", "GSA", "WGS").
      These are splits 1,2,3 of the sample, created by FACTS during the above.

Accomplishment Hours Entry
  Hours credited to: for ARL, the lab group parent org (ARKL)
  Assignment Status needed here per employee entry ("Completed" or "In Progress")?

------------------------------------------------------------------------------------------------
FACTS writing misc notes
  FACTS Status Update
    Analyst should be able to change status from "Assigned" to "In Progress" from their inbox.
  Method source codes:
    AOAC through Vidas (negatives)
    BAM if for positives (method code B160 for SLM)
    Y on spiking => Y on "kit comparison test?" field
      Plus some other kit comparison test data would then need to be supplied.
      S.Gaminara control is the spiking control, so it's data will be sent to FACTS.
------------------------------------------------------------------------------------------------

Sample received-from/date fields (PREP stage)
  Fetch select list from SampleTransfers LABSDS api endpoint.
  Call api with sample num and person id (api doesn't exist yet as of Dec 13 2018).
  Button next to field to do lookup live, for now.
    Will get receipt date and person id. If more than one record, let user select.

Automatic change of FACTS status to In-Progress on first test save.
  Through what LABSDS api?  LabAccomplishmentHours?
    We don't have hours information at this point, just put 0?


Text for API20E - only 5 or so codes, can just use a dropdown.


------------------------------------------------------------------------------------------------
Done
----
Test file attachments: Allow control of ordering and add label for referencing.
Remove controls stage and add its items to pre-enr.
Allow saving and restoring test data to and from files.
Add file attachment point in IDENT stage.
Add reference label text field at end of isolate test seq row, referencing file attachment label.
------------------------------------------------------------------------------------------------

Try upgrade to Spring Boot 2.1 / Spring 5.1.


Test Search Page
----------------
Add test type search params as for status codes.

Initially empty, no resolver necessary.
Search bar at top
  full text search field
  date range
  test types
  FACTS statuses



IDENT
  Need to add page/dialog for building octet code.

Stage status: Just use completion of controls as status (John) for slant/ident stages.

PRE-ENR stage
  Need method/protocol code/name dropdown which is populated from FACTS api.


Turn off preloading for salmonella test module.

FACTS Writing
  Start with updating sample status flag when test is created.
    Creating a test should update sample op status in FACTS.

Create validation functions for test stages.
   Maybe can return enough information to implement status code functions by delegating to the validation functions.

Subcomponents under pos-cont-stages need conflict data to be passed in and rendered.

For API20E may need to capture colors as well as codes.
PFGE/Serology/WGS results
  Just narrative text box for now.


Need carry-over inbox.
  Analyst indicates that rest of work on a sample should be done by someone else (on weekend for example).
  Plus filter at top to see these items.


Move BAM link to top within test name box.

My FACTS person id: 437799


Done
----
Manual refresh from db or FACTS and db, and timestamps of when last updated from both.
Split positives continuation data into separate SLANT and IDENT stages.
  Kept in sync for all isolate manipulations.
  Viewing of other stage data for context can be toggled.
Clean up database to remove old records.
Support for attaching files to aribitrary parts of tests.



Add ui controls for:
   Vitek, API20E
     Record result code and identification conclusion (for each?).  Allow attaching output results file.
   Control samples
   PFGE/Serology/WGS results
     Just narrative text box for now.

From meeting 2018/10/15
  - (app) Add button to immediately refresh from FACTS.
  - Try barcode scanners with new laptops, decide if new barcode scanners are needed.

Supervisor/custodian lab inbox
  Use drag and drop to assign sample ops to employees.

Allow searching for sample information for a given lot # of a reagent (media).

Add data refresh button in main view.

Add ability to associate test files with particular fields, add icons next to field when attached file(s) are present.

Commit Notes
------------

------------

Audit log section of form review report
  Data changes table alignment needs tweaking.
    Use common table for diffs across sections.
    Prevent some to-values from moving to far right.
  Maybe shorten some field names in deep paths, e.g. in positive continuations data, "rvSourcedTests" => "rv".


Try linking to specific section(s) in BAM for each stage.

Pre enr - Maybe make user have to choose to enter values manually for sampling manually.
  Could just disable the sampling detail fields unless user selects an other/custom toggle.
  Run this by John again, he seemed to maybe be OK with it as it is after some discussion.

BAM Integration
   Maybe pick food etc and restrict sampling method choices based on food and BAM.

Maybe print out labels for plates and tubes, which are different from media labels.


Q: What sort of medium type codes will be the prefix for BG, I2KI batches?

Vidas Stage
   Sample detections
      Allow pasting in results or loading from file (see Vidas results output).


Each test needs to be able to allow free-form entry of "continuation page".

Add filters to samples listing.

Maybe allow locking each test section.

TestsService.saveTestData
   Make sure that null value can conflict with non-null value.

Research API, try updating samples from FACTS.

Add ability to attach files to a sample and/or test.

test data entry component
-------------------------
  Allow pasting resource codes to be automatically matched to form fields by type.
  button to apply resources
    Highlight application points in the form.
    Distinguish applied resource codes from those that didn't match any form fields.


Decide how signatures in forms will be handled.
  They can't be handled like other form data, both components must be set automatically only when user passes an authentication test.
  Probably only the form stage should be signable as complete/correct and achieved outside the form?


[SL] Samples Listing

[WB] Water bath whiteboard
  Add general screen to display samples/tests and attach status notes.

[R] manage lab resources
  usual crud ops

[MU] manage employees/users for user's lab group
  usual crud ops

[MLG] manage lab groups

[MTRA] manage test/lab-resource associations (managed and unmanaged)


[dto and ui] Each test view should be able to know the tests current stage, and optionally show each stage's data contents individually.
  + StagedLabTest interface
      stages: string[]
      currentStage: string
  UI will allow flipping through stages for a test.
  Grid of active tests will just show current stages by default.

Create a new service for setting page title in center of toolbar, use this to hold sample listing page title, "Samples".


Forms
  For each boolean choice, form should include a yes/no or pos/neg radio group with same form field name and values 'Y'/'N' or '+'/-'.
    Hopefully this will map naturally to the json field value of null/'+'/'-' etc.

.flexbox-ex {
   display: flex;
   flex-flow: row wrap;
   justify-content: flex-start; // main axis: flex-start/end, center, space-around, space-between, space-evenly
   align-items: stretch;        // cross axis: stretch, center, flex-start, flex-end
}


Barcode Scanners
----------------
Wedge utility for Zebra DS6707
https://www.zebra.com/us/en/support-downloads/software/utilities/cordless-scantoconnect.html

Test Resource Codes
-------------------
BAG-123
JAR-123456
JAR-23456
RV-7361256
TT-228181
BG-7718281
I2KI-7948490
INC-12211
XX-112
XX-113
MB-12312312
